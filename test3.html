<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Weather Prediction</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .city-buttons {
            margin-bottom: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
        }
        .result {
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 20px;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>City Weather Prediction</h1>
    <div class="city-buttons">
        <button onclick="fetchWeather('Boston')">Boston</button>
        <button onclick="fetchWeather('New York')">New York</button>
        <button onclick="fetchWeather('San Francisco')">San Francisco</button>
        <button onclick="fetchWeather('Seattle')">Seattle</button>
        <button onclick="fetchWeather('Miami')">Miami</button>
        <button onclick="fetchWeather('Chicago')">Chicago</button>
        <button onclick="fetchWeather('Washington')">Washington</button>
        <button onclick="fetchWeather('Houston')">Houston</button>
        <button onclick="fetchWeather('Los Angeles')">Los Angeles</button>
        <button onclick="fetchWeather('Las Vegas')">Las Vegas</button>
    </div>
    <div id="result" class="result">
        Click a city button to get the weather prediction.
    </div>

    <script>
        async function fetchWeather(city) {
            const requestData = JSON.stringify({ city_name: city });
    
            try {
                // Trigger API 1 to get weather data
                const weatherResponse = await fetch("https://us-central1-even-card-439404-e2.cloudfunctions.net/get_weather", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: requestData
                });
    
                if (!weatherResponse.ok) {
                    throw new Error(`Weather API error! Status: ${weatherResponse.status}`);
                }
    
                const weatherInfo = await weatherResponse.json();
                displayWeatherData(weatherInfo);
    
                // Prepare API 2 for prediction data, but don't show it yet
                const predictionPromise = fetch("https://us-central1-even-card-439404-e2.cloudfunctions.net/predict_weather", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: requestData
                });
    
                // Create a predict button to fetch the prediction when clicked
                createPredictButton(predictionPromise);
            } catch (error) {
                console.error('Error fetching weather data:', error);
                document.getElementById('result').innerHTML = 'Failed to fetch weather data. Please try again later.';
            }
        }
    
        // Function to display weather data
        function displayWeatherData(weatherInfo) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <h3>Weather for ${weatherInfo.city_name}</h3>
                <p><strong>Source Value:</strong> ${weatherInfo.source_value}</p>
                <p><strong>Temperature (Â°C):</strong> ${weatherInfo.temperature_celsius.toFixed(2)}</p>
                <p><strong>Pressure (hPa):</strong> ${weatherInfo.pressure}</p>
                <p><strong>Humidity (%):</strong> ${weatherInfo.humidity_percent}</p>
                <p><strong>Wind Speed (m/s):</strong> ${weatherInfo.wind_speed}</p>
                <p><strong>Cloudiness (%):</strong> ${weatherInfo.cloudiness_percent}</p>
                <p><strong>Prediction:</strong> <span id="prediction-value">Click Predict for prediction</span></p>
                <div id="predict-button-container"></div>
            `;
        }
    
        // Function to create the Predict button and handle prediction display
        function createPredictButton(predictionPromise) {
            const predictButtonContainer = document.getElementById('predict-button-container');
            predictButtonContainer.innerHTML = '<button id="predict-button">Predict</button>';
            
            const predictButton = document.getElementById('predict-button');
            predictButton.addEventListener('click', async () => {
                // Show loading GIF
                const predictionValue = document.getElementById('prediction-value');
                predictionValue.innerHTML = 'Loading...';
    
                try {
                    // Wait for the prediction result
                    const predictionResponse = await predictionPromise;
    
                    if (!predictionResponse.ok) {
                        throw new Error(`Prediction API error! Status: ${predictionResponse.status}`);
                    }
    
                    const predictionData = await predictionResponse.json();
                    
                    // Hide the GIF and show the prediction result
                    predictionValue.innerHTML = predictionData.prediction;
                } catch (error) {
                    console.error('Error fetching prediction data:', error);
                    predictionValue.innerHTML = 'Failed to fetch prediction.';
                }
            });
        }
    </script>
    
    <div id="result"></div>
    
</body>
</html>
